// ==UserScript==
// @name        wik
// @namespace   https://samswartzberg.com
// @version     0.0.1
// @description No description yet.
// @author      https://samswartzberg.com
// @match       *://*/*
// @grant       none
// @updateURL   https://raw.githubusercontent.com/SamuelSwartzberg/userscripts/master/wik/dist/wik.user.js
// @downloadURL https://raw.githubusercontent.com/SamuelSwartzberg/userscripts/master/wik/dist/wik.user.js
// ==/UserScript==
(()=>{let e=["Noun","Adjective","Verb","Counter","Suffix","Particle"],t=["Synonyms","Antonyms","Derived_terms","Related_terms","Translations"],n=["Etymology","Pronunciation","Further_reading","Anagrams"];function o(){window.setTimeout((()=>document.querySelector("#p-views").innerHTML=window.pViewHtml),1e3)}function l(o){let l,c=function(e){console.log(e);let t="";for(let n=1;n<=e;n++)t=t+"h"+n+",";return t.slice(0,-1)}(o.nodeName.slice(1,2));console.log(o),l=o.childNodes[1]&&"SPAN"===o.childNodes[1].nodeName&&o.childNodes[1].classList.contains("mw-headline")?o.childNodes[1].id:o.firstElementChild.id;let r=!1,i=o,d=[];do{if(d.push(i),!i.nextElementSibling)break;i=i.nextElementSibling,"H2"===i.nodeName&&(r=!0)}while(!i.matches(c));console.log(d);let a=document.createElement("SECTION");a.id=l,e.some((e=>l.includes(e)))&&a.classList.add("word-container"),t.some((e=>l.includes(e)))&&a.classList.add("word-info"),n.some((e=>l.includes(e)))&&a.classList.add("word-parallel"),r&&a.classList.add("language-container"),document.domain.includes("wikt")&&2==o.nodeName.slice(1,2)&&!["German","English","Japanese"].includes(l)&&(console.log("yo"),a.classList.add("hide-default")),d.forEach((e=>a.append(e.cloneNode(!0)))),o.after(a),d.forEach((e=>e.remove()))}window.pViewHtml=document.querySelector("#p-views").innerHTML,function(){"use strict";o(),window.setInterval(o,3e3),document.querySelectorAll("#bodyContent h5").forEach(l),document.querySelectorAll("#bodyContent h4").forEach(l),document.querySelectorAll("#bodyContent h3").forEach(l),document.querySelectorAll("#bodyContent h2:not(#mw-toc-heading)").forEach(l),document.location.search.includes("iframe=true")&&(console.log("In iframe"),document.querySelectorAll("[href]").forEach((e=>e.href+="?iframe=true"))),document.querySelectorAll(".Jpan.headword").forEach((e=>{let t="";for(let n of e.childNodes)if(n.nodeName.includes("#text")&&(t+=n.textContent),n.nodeName.includes("RUBY")){let e=n.querySelector("rt");e.innerHTML=e.textContent,t+=n.innerHTML}e.onclick=t=>{window.prompt("Copy ruby text",e.innerHTML)}}));const e=document.querySelectorAll("section");let t;function n(e,t){let n=document.createElement("SECTION"),o=document.createElement("H2"),l=document.createElement("IFRAME");o.textContent=e,o.classList.add("h-n"),l.src=t,n.classList.add("language-container","hide-default"),n.appendChild(o),n.appendChild(l),document.querySelector(".mw-parser-output").insertBefore(n,document.querySelector("section[id*=Japanese]"))}if(document.addEventListener("scroll",(n=>{if(!(Date.now()-t<50)){t=Date.now();for(let t of e){const e=t.getBoundingClientRect();if(e.top>0&&e.top<250){const e=window.location.toString().split("#")[0];history.replaceState(null,null,e+"#"+t.id),document.querySelectorAll("#toc a").forEach((e=>e.parentNode.classList.remove("currently-in-view"))),document.querySelector(`#toc a[href="#${t.id}"]`).parentNode.classList.add("currently-in-view");break}}}})),document.querySelector("[id*=Japanese]"))try{let e=document.querySelector("h1").innerText;n("Jisho","https://jisho.org/search/"+encodeURIComponent(e)),n("Kanjidamage","https://www.kanjidamage.com/kanji/search?utf8=âœ“&q="+encodeURIComponent(e))}catch(e){console.log(e)}}()})();